name: Publish tag as nightly

on:
  push:
    tags: 
       - '**'

jobs:
  build:
    name: Build and Publish tag as nightly
    runs-on: ubuntu-latest

    steps:
    - name: Checkout Code üìò
      uses: actions/checkout@v3
    - name: Set up JDK 11 ‚òï
      uses: actions/setup-java@v3
      with:
        java-version: '11'
        distribution: 'temurin'
        cache: maven
    - name: Build ‚öíÔ∏è
      # run: mvn -B package --file releng/fr.inria.diverse.melange.releng.root/pom.xml
      run: echo "run when pushing a tag"
    - name: ssh-agent üîë
      uses: webfactory/ssh-agent@v0.5.4
      with:
        ssh-private-key: ${{ secrets.SSH_PRIVATE_KEY }}
    - name: ssh scp pipelines
      env:
        DEPLOYSERVER: "melange.irisa.fr.fr"
        DEPLOYPATH: "/home/web/apache/sites/melange.inria.fr/htdocs/updatesite/nightly"
        LASTSSH: "Doing something after copying"
      run: |
        ping -w 5 ${DEPLOYSERVER}
        ssh -vv -o StrictHostKeyChecking=accept-new web-melange@${DEPLOYSERVER} 'pwd && ls -lsa'