name: Publish tag as nightly

on:
  push:
    tags: 
       - '**'

jobs:
  build:
    name: Build and Publish tag as nightly
    runs-on: ubuntu-latest

    steps:
    - name: Checkout Code 📘
      uses: actions/checkout@v3
    - name: Set up JDK 11 ☕
      uses: actions/setup-java@v3
      with:
        java-version: '11'
        distribution: 'temurin'
        cache: maven
    - name: Build ⚒️
      # run: mvn -B package --file releng/fr.inria.diverse.melange.releng.root/pom.xml
      run: echo "run when pushing a tag"
    - name: ssh-agent 🔑
      uses: webfactory/ssh-agent@v0.5.4
      with:
        ssh-private-key: ${{ secrets.SSH_PRIVATE_KEY }}
    - name: ssh scp ssh pipelines
      uses: cross-the-world/ssh-scp-ssh-pipelines@latest
      env:
        WELCOME: "ssh scp ssh pipelines"
        DEPLOYPATH: "/home/web/apache/sites/melange.inria.fr/htdocs/updatesite/nightly"
        LASTSSH: "Doing something after copying"
      with:
        host: melange.inria.fr
        user: web-melange
        connect_timeout: 10s
        first_ssh: |
          ls -lsa  $DEPLOYPATH 
          export TODAY_UK=`date -Idate`
          echo TODAY_UK = $TODAY_UK
        #scp: |
        #  'releng/fr.inria.diverse.melange.p2updatesite/target/site/*' => '${DEPLOYPATH}/update_${TODAY_UK}'
        #  ./test/test1* => /home/github/test/test1/
        #  ./test/test*.csv => "/home/github/test/test2/"
        #last_ssh: |
        #  echo $LASTSSH && 
        #  (mkdir test1/test || true)
        #  || ls -la
          